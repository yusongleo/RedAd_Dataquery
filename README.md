# 📊 RedAd DataQuery - 小红书聚光广告数据查询助手

**RedAd DataQuery** 是一个自动化的数据管理工具，专为小红书聚光平台（Spotlight）广告投放师设计。

它能够**一键拉取**广告账户的投放数据，并将其自动清洗、同步到飞书多维表格，实现数据的持久化存储与可视化分析。

---

## ✨ 核心功能

- **⚡️ 极速查询**：
- ** 支持自定义日期范围（昨天/近7天/14天/自定义）
- ** 快速拉取聚光广告数据。
- **👯‍♂️ 多账户管理**： **可同时授权多账户，实现不同账户数据快速拉取，账户直接互不干扰**


- **🔄 飞书同步**：
- **分账户同步**： 自动识别要同步的数据所属哪个账户，方便多账户数据管理
- **自动建表**：无需手动创建表格，程序会自动在飞书多维表格中创建以“账户名_账户ID”命名的工作表。
- **智能去重**：内置幂等性检查，自动拦截重复日期的同步请求，防止数据冗余。
- **自动修复**：遇到表格丢失或结构异常时，自动重建表格。
- **📂 历史回溯**：本地保存所有查询记录，支持离线查看（以JSON格式保存，可以选择用记事本打开查看）及二次同步。
- **🔐 安全可靠**：所有Token和配置均存储在用户本地（EXE同级目录），数据隐私无忧。

---

## 🚀 快速开始 

如果您拿到的是打包好的 `.zip` 压缩包，请按照以下步骤操作：

### 1. 解压文件

请务必将压缩包解压到一个文件夹中，**不要直接在压缩包内双击运行**。

### 2. 配置信息 (关键步骤)

#### 1️⃣配置app_config.json

此文件是小红书开放平台平台应用的配置信息（如果你没有开放平台的账号，则无法使用本工具）

小红书开放平台申请地址

https://ad-market.xiaohongshu.com/

当你申请通过之后，可以从后台创建应用，并把应用的相关信息填写到app_config.json文件内（json文件可以选择用记事本打开）

```json
{
  "APP_ID": "xxxxx", // 您的小红书开放平台自建应用的 App ID
  "SECRET": "xxxxxxxx" // 您的小红书开放平台自建应用的 secret
}
```

#### 2️⃣配置auth_url.json

此文件是小红书开放平台应用的授权链接，在你创建小红书开放平台应用的时候会给你

```json
{
  "auth_url": "https://ad-market.xiaohongshu.com/xx" // 您的小红书开放平台应用的授权url
}
```

### 3️⃣配置feishu_config.json

此文件是飞书同步时涉及的配置信息

在解压后的文件夹中，找到 `feishu_config.json` 文件，用记事本打开并填写您的飞书应用信息：

```json
{
  "app_id": "cli_xxxxxxxx", // 您的飞书自建应用 App ID
  "app_secret": "xxxxxxxxxxxxxx", // 您的飞书自建应用 App Secret
  "default_app_token": "xxxxxxxx", // 您的飞书多维表格 Base ID (网址 /base/ 后面的那串字符)
  "account_mapping": {} // 保持为空即可，程序会自动填充
}
```

> **提示**：
>
> - `default_app_token` 是您希望数据存入的那个飞书多维表格文档的 ID。
> - 请确保您的飞书应用（机器人）已被添加到该多维表格文档中，并拥有**编辑权限**。
> - **初次使用**：确保 `feishu_config.json` 中的 `account_mapping` 为 `{}`。程序运行时会自动创建表格，并将生成的 `table_id` 回写到这个配置文件中。
> - **多账户支持**：不同的小红书账户会自动创建（或匹配）不同的飞书数据表，互不干扰。

#### 4️⃣token_config.json无需手动配置，当你授权聚光账户后，会自动填充

**token_config.json的内容不要进行手动修改，否则会导致数据查询失败或授权账户失效**

🛑🛑🛑

**注意：**

**所有配置文件配置完成后，请勿随意修改，否则会导致数据丢失**

**token_config.json里面存放着授权聚光账户的核心数据，切勿随意修改**

🛑🛑🛑

---

### 3. 运行程序

双击 `RedAd_DataQuery.exe` 即可启动。

想要查询指定聚光账户的数据，需要**先进行授权**，然后才能查询

---

## 📖 使用指南

### 功能菜单说明

1.**数据查询 (Data Query)**

- 选择已授权账户。
- 选择查询的时间周期。
- 数据展示后，会自动复制数据到剪切板（数据格式已针对微信聊天优化排版，可以直接粘贴到微信或其他聊天工具，发送给需要同步数据的好友）。
- 数据展示后，输入 `y` 即可自动同步到飞书。

2.**新增/重新授权账户**
 
- 新增授权账户。
- 自动跳转到授权链接，然后登录聚光账户，进行授权操作
- 完成授权后会返回链接，将链接复制到程序会自动解析账户等信息并完成授权

3.**查看已授权账户状态**

- 显示已授权的账户名称、账户ID、Token过期时间

4.**历史记录 (History)**

- 查看本地已保存的所有查询结果。
- 支持重新将历史数据同步到飞书（系统会自动进行去重检查）。
- 查询数据保存在**/data_download/**文件夹内，删除文件夹内的文件即可清除查询记录

---

## ❓ 常见问题 (FAQ)

**Q1: 运行程序闪退怎么办？**

- 请检查是否将 `json` 配置文件（如 `feishu_config.json`）放在了 `.exe` 文件的**同级目录**下。
- 不要将配置文件放入 `_internal` 文件夹。

**Q2: 同步飞书时提示 `Permission denied`？**

- 请进入飞书多维表格页面，点击右上角 **"..." -> "添加应用"**，搜索您的应用名称并添加，确保赋予编辑权限。

**Q3: 提示 `TableIdNotFound` 或 `FieldConvFail`？**

- 不用担心，程序内置了**自愈机制**。它会自动检测到这个错误，并尝试为您创建一个全新的数据表来重新写入数据。

**Q4: 为什么第二次同步相同的数据没有反应？**

- 这是正常的。程序开启了**智能去重**，如果检测到飞书表中已经存在完全相同（账户+日期范围）的数据，会自动跳过，避免数据重复计算。

**Q5: 程序提示token过期，无法进行查询？**

- 因为小红书开放平台的规定，授权账户最高只有30天。

- 通常情况下，程序在你查询数据的时候会自动更新授权时间，但是如果你长期未使用本程序查询数据，可能会发生授权过期的情况，如果出现这种情况，需要你重新对账户进行授权

---

## ⚠️ 免责声明

本工具仅供学习与内部办公提效使用。

- 请妥善保管您的 `app_secret` 和 `token` 文件，不要发送给陌生人。
- 请遵守小红书聚光平台与飞书开放平台的使用规范。

本工具仅对指定聚光数据进行查询，且所有数据的获取方式均为依照小红书开放平台的规定进行调取，不会对聚光账户进行任何操作。

---
